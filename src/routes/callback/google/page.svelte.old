<script lang="ts">
    import { page } from "$app/stores"; 
	import { SearchParamsFromFragment } from "$lib/Helpers";
	import { onMount } from "svelte";
    import * as Cookies from "es-cookie";
	import { goto } from "$app/navigation";

    onMount(() => {
        if ($page?.url) {
            const params = $page.url.searchParams
            params.forEach(e => {
                console.log(e)
            });
            const token = params.get("access_token");
            if (token) {
                Cookies.set("google_token", token);
                success = true;
            } else {
                error = true;
                errorMessage = params.get("error");
            }
        } else {
            throw Error("Couldnt get any kind of url data");
        }
    });

    let success = false;
    let error = false;
    let errorMessage: string | null = "";

    $: if (success === true) {
        goto("/app");
    }
</script>

{#if success === true}
    <div>
        Success, redirecting!
    </div>
{/if}

{#if success === false && error === false}
    <div>
        Getting token!
    </div>
{/if}

{#if error === true}
    <div>
        Failed to login from Google
    </div>
    <div>
        {errorMessage}
    </div>
{/if}